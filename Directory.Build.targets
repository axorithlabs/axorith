<Project>
    <Target Name="PublishModuleToOutput" AfterTargets="Build" Condition="'$(AssemblyName)' != '' And $(AssemblyName.StartsWith('Axorith.Module.'))">
        <PropertyGroup>
            <_ModuleName>$(AssemblyName.Replace('Axorith.Module.', '').Split('.')[0])</_ModuleName>
            <ModuleOutputPath>$(SolutionDir)build\$(Configuration)\modules\$(_ModuleName)\</ModuleOutputPath>
        </PropertyGroup>

        <ItemGroup>
            <ModulePrimaryFiles Include="$(OutputPath)$(AssemblyName).dll" />
            <ModulePrimaryFiles Include="$(OutputPath)$(AssemblyName).pdb" Condition="Exists('$(OutputPath)$(AssemblyName).pdb')" />
        </ItemGroup>
        <ItemGroup>
            <ModuleDependencies Include="@(ReferenceCopyLocalPaths)" Condition="'%(Filename)' != 'Axorith.Sdk'" />
        </ItemGroup>
        <ItemGroup>
            <ModuleMetadataFile Include="$(ProjectDir)module.json" Condition="Exists('$(ProjectDir)module.json')" />
        </ItemGroup>
        <Copy SourceFiles="@(ModulePrimaryFiles)" DestinationFolder="$(ModuleOutputPath)" SkipUnchangedFiles="true" />
        <Copy SourceFiles="@(ModuleDependencies)" DestinationFolder="$(ModuleOutputPath)" SkipUnchangedFiles="true" />
        <Copy SourceFiles="@(ModuleMetadataFile)" DestinationFolder="$(ModuleOutputPath)" SkipUnchangedFiles="true" />

        <Message Text="[Axorith Build] Published module '$(_ModuleName)' to '$(ModuleOutputPath)'" Importance="high" />
    </Target>
</Project>